---
comment: true
language: zh
---

# 哨兵值(sentinel value)——如何用于优化你的循环与算法

在计算机编程中，哨兵值是一种特殊的技巧，用于简化搜索算法和提高代码效率。哨兵值通常是一个预定义的、不会与数据集中的任何有效值混淆的值。通过在数据结构的末尾添加一个哨兵值，可以消除循环中的某些条件检查，从而简化代码并提高性能。

## 哨兵值的定义和作用
哨兵值，也称为标志值、跳闸值、流氓值、信号值或虚拟数据，是算法中使用的特殊值，其存在用作终止条件，通常在循环或递归算法中。这种技术可以减少循环中的条件检查数量，使代码更简洁、更高效。

### 空终止文本字符串&搜索算法中的应用

在编程中，一个典型的哨兵值用例是空终止文本字符串。在一些编程中，字符串以空字符`\0`结束，这使得字符串处理函数（如`strlen`）能够通过查找空字符来确定字符串的结尾。这种方法简化了字符串处理，因为函数只需遍历字符串直到找到空字符即可。

哨兵值在搜索算法中也非常有用。例如，在数组中搜索特定值时，可以在数组末尾添加一个哨兵值，然后使用一个简化的循环来搜索该值。这种方法消除了循环中的边界检查，因为循环将由哨兵值的存在自然终止。


## 例子
在编程中，搜索算法是常见的任务之一，特别是在处理数组或列表时。一个简单的线性搜索算法可能如下所示：

### 基本线性搜索算法
```C++
int find(int arr[], size_t len, int val) {
    for (int i = 0; i < len; i++) {
        if (arr[i] == val) {
            return i; // 找到值，返回索引
        }
    }
    return -1; // 未找到值，返回-1表示无效索引
}
```
在这个基本实现中，我们遍历数组的每个元素，逐一检查是否等于目标值`val`。如果找到了，就返回当前的索引`i`。如果遍历完整个数组都没有找到，就返回-1，表示没有找到目标值。

但是，这会在循环的每次迭代中执行两个测试：是否已找到该值以及是否已到达数组末尾。通过使用哨兵值可以避免后一种测试。假设数组可以扩展一个元素（无需内存分配或清理；这对于链表来说更现实，如下所示），这可以重写为：

### 使用哨兵值优化搜索

```C++
int find(int arr[], size_t len, int val) {
    int i;
    arr[len] = val; // 在数组末尾添加哨兵值
    for (i = 0;; i++) { // 无限循环，直到遇到break语句
        if (arr[i] == val) {
            break; // 找到值，跳出循环
        }
    }
    if (i < len) {
        return i; // 找到值，返回索引
    } else {
        return -1; // 未找到值，返回-1
    }
}
```
在这个实现中，我们在数组`arr`的末尾添加了一个哨兵值（即要搜索的值`val`）。这样，循环就不需要检查是否到达数组末尾，因为无论数组的内容如何，循环都会因为遇到哨兵值而终止。循环结束后，我们检查索引`i`是否小于数组长度`len`来确定是否找到了目标值。

另一种方法是临时替换数组的最后一个元素作为哨兵值
### 哨兵值临时替换数组元素
```C++
int find(int arr[], size_t len, int val) {
    int last;
    if (len == 0) {
        return -1; // 空数组，直接返回-1
    }
    last = arr[len - 1]; // 保存数组最后一个元素的值
    arr[len - 1] = val; // 将最后一个元素设置为哨兵值

    int i;
    for (i = 0;; i++) { // 无限循环，直到遇到break语句
        if (arr[i] == val) {
            break; // 找到值，跳出循环
        }
    }
    arr[len - 1] = last; // 恢复数组最后一个元素的值
    if (arr[i] == val) {
        return i; // 找到值，返回索引
    } else {
        return -1; // 未找到值，返回-1
    }
}
```
在这个实现中，我们首先保存数组最后一个元素的值，然后将它替换为哨兵值。在循环结束后，我们恢复数组最后一个元素的值。这样，即使在循环中找到了哨兵值，我们也需要检查它是否是原始数组中的值，而不是我们添加的哨兵值。

# 最后
哨兵值是一种强大的编程技巧，可以在许多情况下简化搜索算法和提高代码效率。通过在数据结构的末尾添加一个特殊的哨兵值，可以减少循环中的条件检查，使代码更简洁、更高效。这种方法在处理数组、链表和其他数据结构时尤其有用。